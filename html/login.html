<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>级联表格</title>
    <style>
        .table-container {
            width: 80%;
            margin: auto;
            border-collapse: collapse;
        }
        .table-container th, .table-container td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        .table-container th {
            background-color: #f2f2f2;
            text-align: left;
        }
        .arrow {
            cursor: pointer;
        }
        .hidden {
            display: none;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <table id="cascadingTable" class="table-container"></table>

    <script>
        const tableData = {
            "departmentStruct": [
                {
                    "id": 1,
                    "name": "部门1",
                    "parentId": 0,
                    "children": [
                        {
                            "id": 2,
                            "name": "部门1-1",
                            "parentId": 1,
                            "children": [
                                {
                                    "id": 3,
                                    "name": "部门1-1-1",
                                    "parentId": 2,
                                    "children": []
                                },
                                {
                                    "id": 4,
                                    "name": "部门1-1-2",
                                    "parentId": 2,
                                    "children": []
                                },
                                {
                                    "id": 5,
                                    "name": "部门1-1-3",
                                    "parentId": 2,
                                    "children": []
                                }
                            ]
                        },
                        {
                            "id": 6,
                            "name": "部门1-2",
                            "parentId": 1,
                            "children": []
                        }
                    ]
                },
                {
                    "id": 7,
                    "name": "部门2",
                    "parentId": 0,
                    "children": [
                        {
                            "id": 8,
                            "name": "部门2-1",
                            "parentId": 7,
                            "children": []
                        }
                    ]
                },
                {
                    "id": 9,
                    "name": "部门3",
                    "parentId": 0,
                    "children": []
                }
            ]
        };

        function createCascadingTable(tableId, tableData) {
            const $table = $(`#${tableId}`);
            const $thead = $('<thead><tr><th>ID</th><th>Name</th></tr></thead>');
            const $tbody = $('<tbody></tbody>');

            $table.append($thead).append($tbody);

            function addRow(data, level) {
                data.forEach(item => {
                    const $tr = $(`<tr data-id="${item.id}" data-parent-id="${item.parentId}" class="level-${level}"></tr>`);
                    const $arrow = item.children.length > 0 ? $('<span class="arrow">▶</span>') : '';
                    const $name = $('<td></td>').css('padding-left', `${20 * level}px`);
                    
                    $tr.append(`<td>${item.id}</td>`);
                    $name.append($arrow).append(` ${item.name}`);
                    $tr.append($name);

                    $tbody.append($tr);

                    if (item.children.length > 0) {
                        addRow(item.children, level + 1);
                    }
                });
            }

            addRow(tableData.departmentStruct, 0);

            $table.on('click', '.arrow', function () {
                const $arrow = $(this);
                const $tr = $arrow.closest('tr');
                const id = $tr.data('id');
                const level = parseInt($tr.attr('class').match(/level-(\d+)/)[1], 10);

                if ($arrow.text() === '▶') {
                    $arrow.text('▼');
                    showChildren(id, level);
                } else {
                    $arrow.text('▶');
                    hideChildren(id);
                }
            });

            function showChildren(parentId, level) {
                $table.find(`tr[data-parent-id=${parentId}]`).each(function () {
                    const $child = $(this);
                    $child.removeClass('hidden');

                    if ($child.find('.arrow').text() === '▼') {
                        showChildren($child.data('id'), level + 1);
                    }
                });
            }

            function hideChildren(parentId) {
                $table.find(`tr[data-parent-id=${parentId}]`).each(function () {
                    const $child = $(this);
                    $child.addClass('hidden');
                    hideChildren($child.data('id'));
                });
            }
        }

        function checkHeaderData(header, data) {
            return data.departmentStruct.every(item => 
                Object.keys(item).filter(key => key !== 'parentId' && key !== 'children').length === header.length
            );
        }

        $(document).ready(function () {
            const tableHeader = ['ID', 'Name'];
            if (checkHeaderData(tableHeader, tableData)) {
                createCascadingTable('cascadingTable', tableData);
            } else {
                console.error('表头和数据不匹配');
            }
        });
    </script>
</body>
</html>
